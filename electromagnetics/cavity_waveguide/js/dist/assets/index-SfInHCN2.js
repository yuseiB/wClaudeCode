(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const h of s)if(h.type==="childList")for(const d of h.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function c(s){const h={};return s.integrity&&(h.integrity=s.integrity),s.referrerPolicy&&(h.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?h.credentials="include":s.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function r(s){if(s.ep)return;s.ep=!0;const h=c(s);fetch(s.href,h)}})();const k=299792458,$=4e-7*Math.PI,S=1/($*k*k),ce=[[2.4048,5.5201,8.6537],[3.8317,7.0156,10.1735],[5.1356,8.4172,11.6198],[6.3802,9.761,13.0152],[7.5883,11.0647,14.3725]],re=[[3.8317,7.0156,10.1735],[1.8412,5.3314,8.5363],[3.0542,6.7061,9.9695],[4.2012,8.0152,11.3459],[5.3175,9.2824,12.6819]];function Y(e){let t=1,c=1;const r=e*e/4;for(let s=1;s<=30&&(c*=-r/(s*s),t+=c,!(Math.abs(c)<1e-15*Math.abs(t)));s++);return t}function W(e){if(e===0)return 0;let t=.5*e,c=.5*e;const r=e*e/4;for(let s=1;s<=30&&(c*=-r/(s*(s+1)),t+=c,!(Math.abs(c)<1e-15*Math.abs(t)));s++);return t}function N(e,t){if(e===0)return Y(t);if(e===1)return W(t);if(Math.abs(t)<1e-30)return 0;let c=Y(t),r=W(t);for(let s=1;s<e;s++){const h=2*s/t*r-c;c=r,r=h}return r}function se(e,t){return e===0?-W(t):.5*(N(e-1,t)-N(e+1,t))}const G=e=>Math.sqrt(e.ex**2+e.ey**2+e.ez**2),H={ex:0,ey:0,ez:0,hx:0,hy:0,hz:0};function ie(e,t,c,r,s,h,d="TE"){if(d==="TE"&&r===0&&s===0)throw new Error("TE: m and n cannot both be 0");if(d==="TE"&&h<1)throw new Error("TE: p must be >= 1");if(d==="TM"&&(r<1||s<1))throw new Error("TM: m and n must be >= 1");const u=r*Math.PI/e,i=s*Math.PI/t,a=h*Math.PI/c,f=u**2+i**2,l=k*Math.sqrt(u**2+i**2+a**2);return{type:"rect-cavity",a:e,b:t,d:c,m:r,n:s,p:h,modeType:d,kx:u,ky:i,kz:a,kc2:f,omega:l}}function ee(e){return e.omega/(2*Math.PI)}function K(e,t,c,r,s){const{kx:h,ky:d,kz:u,kc2:i,omega:a}=e,f=Math.cos(s),l=Math.sin(s),y=Math.cos(h*t),m=Math.sin(h*t),g=Math.cos(d*c),M=Math.sin(d*c),p=Math.cos(u*r),w=Math.sin(u*r);if(e.modeType==="TE"){const b=y*g*w*l;return i<1e-30?{...H,hz:b}:{ex:a*$*d/i*y*M*w*f,ey:-(a*$*h/i)*m*g*w*f,ez:0,hx:-(h*u/i)*m*g*p*l,hy:-(d*u/i)*y*M*p*l,hz:b}}else{const b=m*M*p*f;return i<1e-30?{...H,ez:b}:{ex:h*u/i*y*M*w*f,ey:d*u/i*m*g*w*f,ez:b,hx:a*S*d/i*m*g*p*l,hy:-(a*S*h/i)*y*M*p*l,hz:0}}}function te(e){return`${e.modeType}_${e.m}${e.n}${e.p}`}function ae(e,t,c,r,s="TE"){if(s==="TE"&&c===0&&r===0)throw new Error("TE: m and n cannot both be 0");if(s==="TM"&&(c<1||r<1))throw new Error("TM: m and n must be >= 1");const h=c*Math.PI/e,d=r*Math.PI/t,u=h**2+d**2,i=k*Math.sqrt(u)/(2*Math.PI);return{type:"rect-wg",a:e,b:t,m:c,n:r,modeType:s,kx:h,ky:d,kc2:u,fc:i}}function D(e,t){const r=(2*Math.PI*t/k)**2-e.kc2;return r>=0?Math.sqrt(r):0}function U(e,t,c,r,s,h){const d=D(e,s),u=2*Math.PI*s,i=Math.cos(h-d*r),{kx:a,ky:f,kc2:l}=e;if(l<1e-30)return H;const y=Math.cos(a*t),m=Math.sin(a*t),g=Math.cos(f*c),M=Math.sin(f*c);return e.modeType==="TE"?{ex:-(u*$*f/l)*y*M*i,ey:u*$*a/l*m*g*i,ez:0,hx:d*a/l*m*g*i,hy:d*f/l*y*M*i,hz:y*g*i}:{ex:-(d*a/l)*y*M*i,ey:-(d*f/l)*m*g*i,ez:m*M*i,hx:u*S*f/l*m*g*i,hy:-(u*S*a/l)*y*M*i,hz:0}}function R(e){return`${e.modeType}_${e.m}${e.n}`}function le(e,t,c,r="TE"){if(c<1)throw new Error("n must be >= 1");if(t>4||c>3)throw new Error("m/n out of table range");const s=r==="TM"?ce[t][c-1]:re[t][c-1],h=s/e,d=k*h/(2*Math.PI);return{type:"circ-wg",r:e,m:t,n:c,modeType:r,chi:s,kc:h,kc2:h**2,fc:d}}function L(e,t){const r=(2*Math.PI*t/k)**2-e.kc2;return r>=0?Math.sqrt(r):0}function de(e,t,c,r,s,h){const d=L(e,s),u=2*Math.PI*s,i=Math.cos(h-d*r),{kc:a,kc2:f,m:l}=e,y=a*t,m=N(l,y),g=se(l,y)*a,M=Math.cos(l*c),p=Math.sin(l*c),w=Math.max(t,1e-30);return e.modeType==="TM"?{ex:-(d*a/f)*g*M*i,ey:d*l/(f*w)*m*p*i,ez:m*M*i,hx:-(u*S*l/(f*w))*m*p*i,hy:u*S*a/f*g*M*i,hz:0}:{ex:u*$*l/(f*w)*m*p*i,ey:-(u*$*a/f)*g*M*i,ez:0,hx:-(d*a/f)*g*M*i,hy:d*l/(f*w)*m*p*i,hz:m*M*i}}function A(e){return`${e.modeType}_${e.m}${e.n}`}function fe(e,t,c,r=200){const s=[],h=[];for(let d=0;d<r;d++){const u=t+(c-t)*d/(r-1);s.push(u),h.push(D(e,u))}return{freqs:s,betas:h}}const E=400,I=400,C=400,z=250;function _(e){const t=Math.max(0,Math.min(1,e));if(t<.33){const c=t/.33;return[255,Math.round(255*(1-c)),Math.round(255*(1-c))]}else if(t<.67){const c=(t-.33)/.34;return[255,Math.round(c*100),0]}else{const c=(t-.67)/.33;return[Math.round(255*(1-c*.5)),0,0]}}const o={viewMode:"rect-cavity",phase:0,playing:!0,speed:.08,rcA:.04,rcB:.02,rcD:.03,rcM:1,rcN:0,rcP:1,rcModeType:"TE",rwA:.04,rwB:.02,rwM:1,rwN:0,rwModeType:"TE",rwFreqMult:1.5,cwR:.015,cwM:1,cwN:1,cwModeType:"TE",cwFreqMult:1.5},O=document.getElementById("fieldCanvas"),q=document.getElementById("dispCanvas"),V=document.getElementById("info"),F=document.getElementById("viewMode"),J=document.getElementById("playBtn"),Q=document.getElementById("speedSlider"),P=document.getElementById("modeTypeBtn");document.getElementById("mPanel");document.getElementById("nPanel");const he=document.getElementById("pPanel"),ue=document.getElementById("freqPanel"),T=O.getContext("2d"),n=q.getContext("2d");O.width=E;O.height=I;q.width=C;q.height=z;const x=80;function Me(){let e;try{e=ie(o.rcA,o.rcB,o.rcD,o.rcM,o.rcN,o.rcP,o.rcModeType)}catch{j(T,"Invalid mode indices");return}const{a:t,d:c}=e,r=E/x,s=I/x,h=[];let d=1e-30;for(let a=0;a<x;a++){h.push([]);for(let f=0;f<x;f++){const l=(f+.5)*t/x,y=(a+.5)*c/x,m=K(e,l,o.rcB/2,y,o.phase),g=G(m);h[a].push(g),g>d&&(d=g)}}const u=T.createImageData(E,I);for(let a=0;a<x;a++)for(let f=0;f<x;f++){const l=h[a][f]/d,[y,m,g]=_(l);for(let M=0;M<Math.ceil(s);M++)for(let p=0;p<Math.ceil(r);p++){const w=Math.floor(a*s)+M,b=Math.floor(f*r)+p;if(w>=I||b>=E)continue;const v=(w*E+b)*4;u.data[v]=y,u.data[v+1]=m,u.data[v+2]=g,u.data[v+3]=255}}T.putImageData(u,0,0);const i=8;T.strokeStyle="rgba(255,255,0,0.8)",T.lineWidth=1.5;for(let a=i/2;a<x;a+=i)for(let f=i/2;f<x;f+=i){const l=(f+.5)*t/x,y=(a+.5)*c/x,m=K(e,l,o.rcB/2,y,o.phase);if(Math.sqrt(m.ex**2+m.ez**2)<.01*d)continue;const M=i*r*.45/d,p=(f+.5)*r,w=(a+.5)*s;oe(T,p,w,m.ex*M,m.ez*M)}T.fillStyle="white",T.font="bold 13px monospace",T.fillText(`${te(e)}  f=${(ee(e)/1e9).toFixed(3)} GHz`,8,20),T.font="11px monospace",T.fillText(`|E| — xz cross-section (y=b/2)   ωt=${(o.phase%(2*Math.PI)).toFixed(2)}`,8,36),we(e)}function pe(){let e;try{e=ae(o.rwA,o.rwB,o.rwM,o.rwN,o.rwModeType)}catch{j(T,"Invalid mode indices");return}const t=e.fc*o.rwFreqMult,c=D(e,t),{a:r,b:s}=e,h=E/x,d=I/x,u=[];let i=1e-30;for(let l=0;l<x;l++){u.push([]);for(let y=0;y<x;y++){const m=(y+.5)*r/x,g=(l+.5)*s/x,M=U(e,m,g,0,t,o.phase),p=G(M);u[l].push(p),p>i&&(i=p)}}const a=T.createImageData(E,I);for(let l=0;l<x;l++)for(let y=0;y<x;y++){const m=u[l][y]/i,[g,M,p]=_(m);for(let w=0;w<Math.ceil(d);w++)for(let b=0;b<Math.ceil(h);b++){const v=Math.floor(l*d)+w,X=Math.floor(y*h)+b;if(v>=I||X>=E)continue;const B=(v*E+X)*4;a.data[B]=g,a.data[B+1]=M,a.data[B+2]=p,a.data[B+3]=255}}T.putImageData(a,0,0);const f=8;T.strokeStyle="rgba(0,255,255,0.8)",T.lineWidth=1.5;for(let l=f/2;l<x;l+=f)for(let y=f/2;y<x;y+=f){const m=(y+.5)*r/x,g=(l+.5)*s/x,M=U(e,m,g,0,t,o.phase);if(Math.sqrt(M.ex**2+M.ey**2)<.02*i)continue;const w=f*h*.45/i,b=(y+.5)*h,v=(l+.5)*d;oe(T,b,v,M.ex*w,M.ey*w)}T.fillStyle="white",T.font="bold 13px monospace",T.fillText(`${R(e)}  fc=${(e.fc/1e9).toFixed(3)} GHz`,8,20),T.font="11px monospace",T.fillText(`f=${(t/1e9).toFixed(3)} GHz  β=${c.toFixed(1)} rad/m  ωt=${(o.phase%(2*Math.PI)).toFixed(2)}`,8,36),me(e,t),Te(e,t,c)}function ye(){let e;try{e=le(o.cwR,o.cwM,o.cwN,o.cwModeType)}catch{j(T,"Invalid mode indices");return}const t=e.fc*o.cwFreqMult,c=L(e,t),r=e.r,s=E/x,h=I/x,d=[];let u=1e-30;for(let a=0;a<x;a++){d.push([]);for(let f=0;f<x;f++){const l=(f/x-.5)*2*r,y=(a/x-.5)*2*r,m=Math.sqrt(l**2+y**2),g=Math.atan2(y,l);if(m>r){d[a].push(NaN);continue}const M=de(e,m,g,0,t,o.phase),p=G(M);d[a].push(p),p>u&&(u=p)}}const i=T.createImageData(E,I);for(let a=0;a<x;a++)for(let f=0;f<x;f++){const l=d[a][f];let y=30,m=30,g=30;isNaN(l)||([y,m,g]=_(l/u));for(let M=0;M<Math.ceil(h);M++)for(let p=0;p<Math.ceil(s);p++){const w=Math.floor(a*h)+M,b=Math.floor(f*s)+p;if(w>=I||b>=E)continue;const v=(w*E+b)*4;i.data[v]=y,i.data[v+1]=m,i.data[v+2]=g,i.data[v+3]=255}}T.putImageData(i,0,0),T.strokeStyle="white",T.lineWidth=2,T.beginPath(),T.arc(E/2,I/2,r/(2*r)*E,0,2*Math.PI),T.stroke(),T.fillStyle="white",T.font="bold 13px monospace",T.fillText(`${A(e)}  fc=${(e.fc/1e9).toFixed(3)} GHz`,8,20),T.font="11px monospace",T.fillText(`f=${(t/1e9).toFixed(3)} GHz  β=${c.toFixed(1)} rad/m  ωt=${(o.phase%(2*Math.PI)).toFixed(2)}`,8,36),ge(e,t),xe(e,t,c)}function oe(e,t,c,r,s){const h=Math.sqrt(r**2+s**2);if(h<.5)return;e.beginPath(),e.moveTo(t-r/2,c-s/2),e.lineTo(t+r/2,c+s/2);const d=Math.atan2(s,r),u=Math.min(h*.4,5);e.moveTo(t+r/2,c+s/2),e.lineTo(t+r/2-u*Math.cos(d-.5),c+s/2-u*Math.sin(d-.5)),e.moveTo(t+r/2,c+s/2),e.lineTo(t+r/2-u*Math.cos(d+.5),c+s/2-u*Math.sin(d+.5)),e.stroke()}function j(e,t){e.fillStyle="#1a1a2e",e.fillRect(0,0,E,I),e.fillStyle="#ff6b6b",e.font="14px monospace",e.fillText(t,20,I/2)}function me(e,t){n.fillStyle="#0d1117",n.fillRect(0,0,C,z);const c=e.fc,r=c*3,{freqs:s,betas:h}=fe(e,0,r),d=h[h.length-1]*1.05,u=45,i=15,a=C-u-20,f=z-i-35,l=M=>u+M/r*a,y=M=>i+f-M/d*f;n.strokeStyle="#333",n.lineWidth=.5;for(let M=0;M<=5;M++){const p=i+M*f/5;n.beginPath(),n.moveTo(u,p),n.lineTo(u+a,p),n.stroke(),n.fillStyle="#aaa",n.font="10px monospace",n.fillText((d*(5-M)/5).toFixed(0),2,p+4)}n.strokeStyle="#4fc3f7",n.lineWidth=2,n.beginPath(),s.forEach((M,p)=>{const w=l(M),b=y(h[p]);p===0?n.moveTo(w,b):n.lineTo(w,b)}),n.stroke(),n.strokeStyle="#888",n.setLineDash([4,4]),n.lineWidth=1,n.beginPath(),n.moveTo(l(0),y(0)),n.lineTo(l(r),y(r/k)),n.stroke(),n.setLineDash([]),n.strokeStyle="#ff9800",n.lineWidth=1.5,n.setLineDash([4,2]);const m=l(c);n.beginPath(),n.moveTo(m,i),n.lineTo(m,i+f),n.stroke(),n.setLineDash([]);const g=D(e,t);n.fillStyle="#ff5252",n.beginPath(),n.arc(l(t),y(g),5,0,2*Math.PI),n.fill(),n.fillStyle="#ccc",n.font="11px monospace",n.fillText(`fc=${(c/1e9).toFixed(2)}G`,m-28,i+f+14),n.fillText("f →",u+a-20,i+f+28),n.fillText("β",2,i+6),n.fillStyle="#4fc3f7",n.font="bold 11px monospace",n.fillText(`Dispersion: ${R(e)}  (ω vs β)`,u,i-2)}function ge(e,t){n.fillStyle="#0d1117",n.fillRect(0,0,C,z);const c=e.fc,r=c*3,s=200,h=[],d=[];for(let p=0;p<s;p++){const w=p*r/(s-1);h.push(w),d.push(L(e,w))}const u=Math.max(d[d.length-1]*1.05,1),i=45,a=15,f=C-i-20,l=z-a-35,y=p=>i+p/r*f,m=p=>a+l-p/u*l;n.strokeStyle="#333",n.lineWidth=.5;for(let p=0;p<=5;p++){const w=a+p*l/5;n.beginPath(),n.moveTo(i,w),n.lineTo(i+f,w),n.stroke(),n.fillStyle="#aaa",n.font="10px monospace",n.fillText((u*(5-p)/5).toFixed(0),2,w+4)}n.strokeStyle="#80cbc4",n.lineWidth=2,n.beginPath(),h.forEach((p,w)=>{const b=y(p),v=m(d[w]);w===0?n.moveTo(b,v):n.lineTo(b,v)}),n.stroke(),n.strokeStyle="#888",n.setLineDash([4,4]),n.lineWidth=1,n.beginPath(),n.moveTo(y(0),m(0)),n.lineTo(y(r),m(r/k)),n.stroke(),n.setLineDash([]),n.strokeStyle="#ff9800",n.lineWidth=1.5,n.setLineDash([4,2]);const g=y(c);n.beginPath(),n.moveTo(g,a),n.lineTo(g,a+l),n.stroke(),n.setLineDash([]);const M=L(e,t);n.fillStyle="#ff5252",n.beginPath(),n.arc(y(t),m(M),5,0,2*Math.PI),n.fill(),n.fillStyle="#ccc",n.font="11px monospace",n.fillText(`fc=${(c/1e9).toFixed(2)}G`,g-28,a+l+14),n.fillStyle="#80cbc4",n.font="bold 11px monospace",n.fillText(`Dispersion: ${A(e)}  (ω vs β)`,i,a-2)}function we(e){const t=ee(e);V.innerHTML=`
    <b>${te(e)}</b>  f<sub>res</sub> = ${(t/1e9).toFixed(4)} GHz<br>
    a=${(e.a*100).toFixed(0)} cm, b=${(e.b*100).toFixed(0)} cm, d=${(e.d*100).toFixed(0)} cm<br>
    λ = ${(k/t*100).toFixed(2)} cm<br>
    <small>E~cos(ωt) (hot=max),  H~sin(ωt)  [90° phase shift]</small>
  `}function Te(e,t,c){const r=c>0?2*Math.PI/c*100:1/0;V.innerHTML=`
    <b>${R(e)}</b>  f<sub>c</sub> = ${(e.fc/1e9).toFixed(4)} GHz<br>
    f<sub>op</sub> = ${(t/1e9).toFixed(3)} GHz  (${o.rwFreqMult.toFixed(1)}×f<sub>c</sub>)<br>
    β = ${c.toFixed(1)} rad/m   λ<sub>g</sub> = ${isFinite(r)?r.toFixed(2):"∞"} cm<br>
    v<sub>ph</sub>/c = ${c>0?(t/(c*k/(2*Math.PI)*k)).toFixed(2):"—"}
    <small style="float:right">▶ yellow arrows = E-field</small>
  `}function xe(e,t,c){const r=c>0?2*Math.PI/c*100:1/0;V.innerHTML=`
    <b>${A(e)}</b>  f<sub>c</sub> = ${(e.fc/1e9).toFixed(4)} GHz<br>
    R = ${(e.r*100).toFixed(1)} cm  χ = ${e.chi.toFixed(4)}<br>
    f<sub>op</sub> = ${(t/1e9).toFixed(3)} GHz  β = ${c.toFixed(1)} rad/m<br>
    λ<sub>g</sub> = ${isFinite(r)?r.toFixed(2):"∞"} cm
    <small style="float:right">▶ cyan = E in (ρ,φ) plane</small>
  `}function ne(){switch(T.fillStyle="#0d1117",T.fillRect(0,0,E,I),o.viewMode){case"rect-cavity":Me();break;case"rect-wg":pe();break;case"circ-wg":ye();break}o.playing&&(o.phase+=o.speed),requestAnimationFrame(ne)}function Z(){he.style.display=o.viewMode==="rect-cavity"?"block":"none",ue.style.display=o.viewMode!=="rect-cavity"?"block":"none",q.style.display=o.viewMode!=="rect-cavity"?"block":"none"}F.addEventListener("change",()=>{o.viewMode=F.value,Z()});J.addEventListener("click",()=>{o.playing=!o.playing,J.textContent=o.playing?"⏸ Pause":"▶ Play"});Q.addEventListener("input",()=>{o.speed=parseFloat(Q.value)});P.addEventListener("click",()=>{o.viewMode==="rect-cavity"?(o.rcModeType=o.rcModeType==="TE"?"TM":"TE",P.textContent=`Mode: ${o.rcModeType}`,o.rcModeType==="TM"&&(o.rcM<1&&(o.rcM=1),o.rcN<1&&(o.rcN=1))):o.viewMode==="rect-wg"?(o.rwModeType=o.rwModeType==="TE"?"TM":"TE",P.textContent=`Mode: ${o.rwModeType}`):(o.cwModeType=o.cwModeType==="TE"?"TM":"TE",P.textContent=`Mode: ${o.cwModeType}`)});document.querySelectorAll("[data-preset]").forEach(e=>{e.addEventListener("click",()=>{switch(e.dataset.preset){case"te101":o.viewMode="rect-cavity",o.rcModeType="TE",o.rcM=1,o.rcN=0,o.rcP=1,F.value="rect-cavity",P.textContent="Mode: TE";break;case"tm110":o.viewMode="rect-cavity",o.rcModeType="TM",o.rcM=1,o.rcN=1,o.rcP=0,F.value="rect-cavity",P.textContent="Mode: TM";break;case"te10":o.viewMode="rect-wg",o.rwModeType="TE",o.rwM=1,o.rwN=0,F.value="rect-wg",P.textContent="Mode: TE";break;case"te11c":o.viewMode="circ-wg",o.cwModeType="TE",o.cwM=1,o.cwN=1,F.value="circ-wg",P.textContent="Mode: TE";break}Z()})});document.getElementById("mSlider").addEventListener("input",e=>{const t=parseInt(e.target.value);o.viewMode==="rect-cavity"?o.rcM=t:o.viewMode==="rect-wg"?o.rwM=t:o.cwM=t,document.getElementById("mVal").textContent=String(t)});document.getElementById("nSlider").addEventListener("input",e=>{const t=parseInt(e.target.value);o.viewMode==="rect-cavity"?o.rcN=t:o.viewMode==="rect-wg"?o.rwN=t:o.cwN=t,document.getElementById("nVal").textContent=String(t)});document.getElementById("pSlider").addEventListener("input",e=>{const t=parseInt(e.target.value);o.viewMode==="rect-cavity"&&(o.rcP=t),document.getElementById("pVal").textContent=String(t)});document.getElementById("freqSlider").addEventListener("input",e=>{const t=parseFloat(e.target.value);o.viewMode==="rect-wg"?o.rwFreqMult=t:o.cwFreqMult=t,document.getElementById("freqVal").textContent=`${t.toFixed(1)}×fc`});Z();ne();
